<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Tactics Flashcards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>

    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
    }

    h1 { text-align:center; }

    #top-center-buttons {
      display:flex;
      justify-content:center;
      gap:14px;
      margin-bottom:12px;
    }

    #topBar {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      align-items:center;
      margin-bottom:12px;
      font-size:0.9em;
    }

    #card {
      text-align: center;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 6px;
      max-width: 500px;
      margin: 0 auto;
    }

    #boardImg {
      width: 100%;
      max-width: 420px;
      margin-top:10px;
      border:1px solid #ccc;
    }

    button,
    select,
    input[type="file"] {
      padding: 8px 20px;
      border-radius: 999px;
      border: 1px solid #d0d7de;
      background: linear-gradient(to bottom, #ffffff, #f3f4f6);
      cursor: pointer;
      font-size: 0.9em;
      font-weight:500;
    }

    #controls { margin-top:15px; }

    #controls > div {
      display:flex;
      justify-content:center;
      gap:14px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }

    #favoriteIndicator {
      font-size:1.4em;
      margin-left:5px;
      color:#999;
    }

    #favoriteIndicator.active {
      color:gold;
    }

    #bottom-file div { font-size:0.78em; opacity:0.8; }

    /* DARK MODE */
    .dark-mode { background:#141414; color:#eee; }
    .dark-mode #card { border-color:#444; }
    .dark-mode #boardImg { border-color:#555; }
    .dark-mode button,
    .dark-mode select,
    .dark-mode input[type="file"] {
      background:#2a2a2a;
      border-color:#666;
      color:#eee;
    }
    .dark-mode #favoriteIndicator { color:#666; }
    .dark-mode #favoriteIndicator.active { color:gold; }

    /* MOBILE OPTIMIZATION */
    @media(max-width:600px){

      #controls > div {
        display:grid;
        grid-template-columns:1fr 1fr;
        gap:10px;
        justify-items:center;
      }

      button,
      select,
      input[type="file"] {
        width:90%;
        max-width:220px;
        padding:6px 14px;
        font-size:0.82em;
      }

      #top-center-buttons {
        flex-direction:column;
      }
    }

  </style>

</head>


<body>

  <h1>Tactics Flashcards</h1>

  <div id="statusMsg" style="text-align:center; font-weight:700; margin-bottom:12px; color:green;"></div>

  <div style="text-align:center; font-size:0.9em; margin-bottom:15px;">
    <img src="/data/Sharpen cover.png" style="width:55%; max-width:230px; display:block; margin:0 auto 8px;">
    Source of tactical positions: from the book <em>Sharpen Your Tactics!</em><br>
    by Grandmasters Anatoly Lein & Boris Archangelsky
  </div>


  <div id="top-center-buttons">
    <button id="openFenBuilderBtn">Use lichess.org FEN Builder</button>

    <select id="themeSelect">
      <option value="light">Light background</option>
      <option value="dark">Dark background</option>
    </select>
  </div>


  <div id="topBar">
    <button id="modeBtn">Mode: Random</button>
    <button id="jumpBtn">Go to number #</button>

    <select id="rangeSelect">
      <option value="">Choose Difficulty</option>
      <option value="1-10,12-14">***</option>
      <option value="11,15">****</option>
    </select>
  </div>



  <div id="card">

    <div id="problemCounter" style="margin-bottom:8px; font-weight:700; font-size:1.1em; color:#0a7c24;"></div>

    <img id="boardImg">

    <div id="controls">

      <div>
        <button id="previous-btn">← Previous</button>
        <button id="next-btn">Next →</button>
        <button id="favorite-btn">★ Favorite</button>
        <span id="favoriteIndicator">☆</span>
      </div>

      <div id="bottom-file">
        <input type="file" id="upload" multiple accept="image/*">
        <div>(Upload only images and screenshots)</div>
        <div style="font-size:0.8em; font-weight:700; color:green; margin-top:4px;">The images you uploade are temporary – lost on refresh<br>On refresh you upload the default images.</div>
      </div>

    </div>

  </div>


<script>
let TOTAL = parseInt(prompt("How many images are in your 'problems' folder?"));
if (!Number.isFinite(TOTAL) || TOTAL < 1) TOTAL = 15;

const statusMsg = document.getElementById("statusMsg");
statusMsg.textContent = "Default images loaded";
statusMsg.style.color = "green";

const cards = [];
for (let i = 1; i <= TOTAL; i++) {
  cards.push({
    id: i,
    image: `problems/problem_${i}.png`,
    favorite:false
  });
}

const boardImg = document.getElementById("boardImg");
const favoriteIndicator = document.getElementById("favoriteIndicator");
const modeBtn = document.getElementById("modeBtn");
const uploadInput = document.getElementById("upload");

let currentIndex = 0;
let mode = "random"; // "random" ή "sequential"

// ενημέρωση κειμένου κουμπιού mode
function updateModeButton(){
  modeBtn.textContent = (mode === "random")
    ? "Mode: Random"
    : "Mode: Sequential";
}

function showCard(i){
  const c = cards[i];
  boardImg.src = c.image;

  document.getElementById("problemCounter").textContent =
    "Problem " + (i+1) + " of " + cards.length;

  favoriteIndicator.textContent = c.favorite ? "★" : "☆";
  favoriteIndicator.classList.toggle("active", c.favorite);
}

updateModeButton();
showCard(currentIndex);

// toggle mode Random/Sequential
modeBtn.onclick = () => {
  mode = (mode === "random") ? "sequential" : "random";
  updateModeButton();
};

// helper για τυχαίο index διαφορετικό από το current
function getRandomDifferentIndex(){
  if (cards.length <= 1) return currentIndex;
  let newIndex = currentIndex;
  while (newIndex === currentIndex) {
    newIndex = Math.floor(Math.random() * cards.length);
  }
  return newIndex;
}

document.getElementById("next-btn").onclick = ()=>{
  if (mode === "random") {
    currentIndex = getRandomDifferentIndex();
  } else {
    currentIndex = (currentIndex+1)%cards.length;
  }
  showCard(currentIndex);
};

document.getElementById("previous-btn").onclick = ()=>{
  if (mode === "random") {
    currentIndex = getRandomDifferentIndex();
  } else {
    currentIndex = (currentIndex-1+cards.length)%cards.length;
  }
  showCard(currentIndex);
};

document.getElementById("favorite-btn").onclick = ()=>{
  cards[currentIndex].favorite = !cards[currentIndex].favorite;
  showCard(currentIndex);
};

document.getElementById("jumpBtn").onclick = ()=>{
  const v = parseInt(prompt("Enter number (1-"+cards.length+")"));
  if(v>=1 && v<=cards.length){
    currentIndex = v-1;
    showCard(currentIndex);
  }
};

document.getElementById("rangeSelect").onchange = e => {
  const v = e.target.value;
  if(!v) return;
  const arr=[];
  v.split(",").forEach(s=>{
    if(s.includes("-")){
      let[a,b]=s.split("-").map(Number);
      for(let x=a;x<=b;x++) arr.push(x);
    } else arr.push(Number(s));
  });
  currentIndex = arr[Math.floor(Math.random()*arr.length)]-1;
  showCard(currentIndex);
};

document.getElementById("themeSelect").onchange = ()=>{
  if(themeSelect.value==="dark") document.body.classList.add("dark-mode");
  else document.body.classList.remove("dark-mode");
};

document.getElementById('openFenBuilderBtn').onclick=()=>{
  window.open("https://lichess.org/editor","_blank");
};

// ====== UPLOAD HANDLER: προσθήκη uploaded εικόνων + μήνυμα ======
uploadInput.addEventListener("change", (event) => {
  const files = Array.from(event.target.files || []).filter(f =>
    f.type.startsWith("image/")
  );

  if (!files.length) {
    statusMsg.textContent = "No image files selected.";
    statusMsg.style.color = "red";
    return;
  }

  files.forEach(file => {
    const url = URL.createObjectURL(file);
    cards.push({
      id: cards.length + 1,
      image: url,
      favorite: false
    });
  });

  statusMsg.style.color = "green";
  statusMsg.textContent =
    files.length === 1
      ? "1 uploaded image added after the default problems."
      : files.length + " uploaded images added after the default problems.";

  // Πήγαινε στην πρώτη από τις νέες εικόνες
  currentIndex = cards.length - files.length;
  showCard(currentIndex);
});
</script>

</body>
</html>
