<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tactics Flashcards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
    }
    h1 {
      text-align: center;
    }
    #topBar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      align-items: center;
      margin-bottom: 12px;
      font-size: 0.9em;
    }
    #card {
      text-align: center;
      border: 1px solid #ddd;
      padding: 12px;
      border-radius: 6px;
    }
    #boardImg {
      width: 400px;
      max-width: 100%;
      height: auto;
      border: 1px solid #ccc;
      margin-top: 8px;
    }
    .controls {
      margin-top: 12px;
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }
    button {
      padding: 6px 14px;
      cursor: pointer;
      border-radius: 4px;
      border: 1px solid #777;
      background: #f4f4f4;
    }
    button:hover {
      background: #e8e8e8;
    }
    #solution {
      margin-top: 10px;
      font-weight: bold;
    }
    #meta, #stats {
      margin-top: 6px;
      font-size: 0.9em;
      color: #333;
    }
    #favoriteIndicator {
      font-size: 1.2em;
      margin-left: 6px;
    }
    #favoriteIndicator.active {
      color: gold;
    }
    input[type="file"] {
  padding: 6px 14px;
  cursor: pointer;
  border-radius: 4px;
  border: 1px solid #777;
  background: #f4f4f4;
   }

input[type="file"]:hover {
  background: #e8e8e8;
   }

  </style>
</head>
<body>
  <h1>Tactics Flashcards</h1>

  <div id="topBar"></div>

  <div id="card">
    <div id="meta"></div>
    <img id="boardImg" src="" alt="Position" />
    <span id="favoriteIndicator">☆</span>

    <div class="controls">
      <!--  <button id="btnShow">Show solution</button> 
      <button id="btnCorrect">I solved it</button>
      <button id="btnWrong">I missed it</button> -->
      <button id="btnPrev">⟵ Previous</button>
      <button id="btnNext">Next ⟶</button>
      <button id="btnFavorite">★ Favorite</button>
      <input id="uploadInput" type="file" accept="image/*" multiple />
      <span style="font-size:0.85em; color:#555;">(images-screenshots only)</span>
    </div>

    <div id="solution" style="display:none;"></div>
    <div id="stats"></div>
  </div>

  <script>

    let mode = "random";

    function safePath(path) {
      return encodeURI(path);
    }

    const TOTAL = 1125;
    const cards = [];

    for (let i = 1; i <= TOTAL; i++) {
      cards.push({
        id: i,
        bookNumber: i,
        page: Math.floor((i - 1) / 12) + 1,
        image: `problems/problem_${i}.png`,
        ease: 2.5,
        interval: 1,
        due: Date.now(),
        correct: 0,
        wrong: 0,
        favorite: false
      });
    }

    const progressKey = "sharpen_flashcards_progress_v3";

    function loadProgress() {
      try { return JSON.parse(localStorage.getItem(progressKey)) || {}; }
      catch { return {}; }
    }

    function saveProgress(data) {
      localStorage.setItem(progressKey, JSON.stringify(data));
    }

    let progress = loadProgress();

    function restoreProgressToCards() {
      for (const card of cards) {
        const p = progress[card.id];
        if (p) {
          card.ease = p.ease ?? card.ease;
          card.interval = p.interval ?? card.interval;
          card.due = p.due ?? card.due;
          card.correct = p.correct ?? 0;
          card.wrong = p.wrong ?? 0;
          card.favorite = p.favorite ?? false;
        }
      }
    }
    restoreProgressToCards();

    function syncCardToProgress(card) {
      progress[card.id] = {
        ease: card.ease,
        interval: card.interval,
        due: card.due,
        correct: card.correct,
        wrong: card.wrong,
        favorite: card.favorite
      };
      saveProgress(progress);
    }

    function getNextDueCardIndex() {
      const now = Date.now();

      const dueCards = cards
        .map((c, i) => ({c, i}))
        .filter(o => o.c.due <= now);

      if (dueCards.length > 0) {
        const pick = dueCards[Math.floor(Math.random() * dueCards.length)];
        return pick.i;
      } else {
        return Math.floor(Math.random() * cards.length);
      }
    }

    let currentIndex = getNextDueCardIndex();

    function showCard(index) {
      const card = cards[index];
      const img = document.getElementById("boardImg");
      img.src = safePath(card.image);

      document.getElementById("meta").textContent = "";
      document.getElementById("solution").style.display = "none";
      document.getElementById("solution").textContent = card.solution || "";
      
      const favInd = document.getElementById("favoriteIndicator");
      favInd.classList.toggle("active", card.favorite);
      favInd.textContent = card.favorite ? "★" : "☆";

      // document.getElementById("stats").textContent =
      //   "Solved: " + card.correct + " | Missed: " + card.wrong;
    }

    // document.getElementById("btnShow").addEventListener("click", () => {
    //   document.getElementById("solution").style.display = "block";
    // });

    document.getElementById("btnNext").addEventListener("click", () => {
      currentIndex = getNextDueCardIndex();
      showCard(currentIndex);
    });

    document.getElementById("btnPrev").addEventListener("click", () => {
      currentIndex = getNextDueCardIndex();
      showCard(currentIndex);
    });

   // document.getElementById("btnCorrect").addEventListener("click", () => {
   //   const card = cards[currentIndex];
   //   card.correct++;
   //   syncCardToProgress(card);

  //    currentIndex = getNextDueCardIndex();
  //    showCard(currentIndex);
  //  });

  //  document.getElementById("btnWrong").addEventListener("click", () => {
  //    const card = cards[currentIndex];
  //   card.wrong++;
  //    syncCardToProgress(card);

  //    currentIndex = getNextDueCardIndex();
  //    showCard(currentIndex);
  //  });

    document.getElementById("btnFavorite").addEventListener("click", () => {
      const card = cards[currentIndex];
      card.favorite = !card.favorite;
      syncCardToProgress(card);
      showCard(currentIndex);
    });

  //  document.getElementById("btnRandom").addEventListener("click", () => {
  //   mode = "random";
  //    currentIndex = getNextDueCardIndex();
  //    showCard(currentIndex);
  //  });

  //  document.getElementById("btnOrdered").addEventListener("click", () => {
  //    mode = "ordered";
  //    currentIndex = 0;
  //    showCard(currentIndex);
  //  });

   window.addEventListener("load", () => {
  currentIndex = getNextDueCardIndex();
  showCard(currentIndex);
});

    // Load custom images
const customKey = "sharpen_custom_images";
let customImages = JSON.parse(localStorage.getItem(customKey)) || [];

function saveCustomImages() {
  localStorage.setItem(customKey, JSON.stringify(customImages));
}

document.getElementById("uploadInput").addEventListener("change", async (e) => {
  const files = Array.from(e.target.files);

  for (const file of files) {
    const url = URL.createObjectURL(file);

    const newCard = {
      id: "u_" + Date.now() + "_" + Math.random().toString(36).slice(2),
      bookNumber: "custom",
      page: "-",
      image: url,
      ease: 2.5,
      interval: 1,
      due: Date.now(),
      correct: 0,
      wrong: 0,
      favorite: false
    };

    cards.push(newCard);
    customImages.push({ url });
  }

  saveCustomImages();

  currentIndex = cards.length - 1;
  showCard(currentIndex);
});

  </script>
</body>
</html>






