<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Tactics Flashcards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
    }

    h1 {
      text-align: center;
    }

    #top-center-buttons {
      display:flex;
      justify-content:center;
      gap:10px;
      margin-bottom:12px;
    }

    #topBar {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      align-items: center;
      margin-bottom: 12px;
      font-size: 0.9em;
    }

    #card {
      text-align: center;
      border: 1px solid #ddd;
      padding: 12px;
      border-radius: 6px;
      max-width: 470px;
      margin: 0 auto;
    }

    #boardImg {
      width: 400px;
      max-width: 100%;
      height: auto;
      border: 1px solid #ccc;
      margin-top: 8px;
    }

    button,
    input[type="file"],
    select {
      padding: 8px 18px;
      border-radius: 999px;
      border: 1px solid #d0d7de;
      background: linear-gradient(to bottom, #ffffff, #f3f4f6);
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 500;
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.08);
      transition:
        background 0.15s ease,
        box-shadow 0.15s ease,
        transform 0.08s ease,
        border-color 0.15s ease;
    }

    button:hover,
    input[type="file"]:hover,
    select:hover {
      background: linear-gradient(to bottom, #f9fafb, #e5e7eb);
      box-shadow: 0 2px 4px rgba(15, 23, 42, 0.16);
      transform: translateY(-1px);
      border-color: #9ca3af;
    }

    button:active,
    input[type="file"]:active,
    select:active {
      transform: translateY(0);
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.1);
    }

    /* ←–––––––––––––––––––––––––––––– */
    /* FIX: make file input text visible */
    input[type="file"] {
      color:#000;
    }
    input[type="file"]::-webkit-file-upload-button {
      color:#000;
    }

    .dark-mode input[type="file"] {
      color:#eee;
    }
    .dark-mode input[type="file"]::-webkit-file-upload-button {
      color:#eee;
    }
    /* ––––––––––––––––––––––––––––––→ */

    #solution {
      margin-top: 10px;
      font-weight: bold;
    }

    #meta,
    #stats {
      margin-top: 6px;
      font-size: 0.9em;
      color: #333;
    }

    #favoriteIndicator {
      font-size: 1.2em;
      margin-left: 6px;
    }

    #favoriteIndicator.active {
      color: gold;
    }

    #controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    #top-buttons {
      display: flex;
      flex-direction: row;
      gap: 10px;
      justify-content: center;
    }

    #bottom-file {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #bottom-file div {
      font-size: 0.8em;
      opacity: 0.8;
      margin-top: 6px;
    }

    /* DARK MODE */
    .dark-mode {
      background:#1e1e1e;
      color:#eee;
    }

    .dark-mode #card {
      border-color:#555;
    }

    .dark-mode #boardImg {
      border-color:#666;
    }

  </style>
</head>

<body>
  <h1>Tactics Flashcards</h1>

  <div id="statusMsg" style="text-align:center; margin-bottom:9px; color:green;"></div>

  <div style="text-align:center; font-size:0.85em; margin-bottom:12px;">
    <img src="/data/Sharpen cover.png" style="width:120px; display:block; margin:0 auto 6px;">
    Source of tactical positions: from the book <em>Sharpen Your Tactics!</em><br>
    Grandmaster Anatoly Lein & Boris Archangelsky
  </div>

  <div id="top-center-buttons">
    <button id="openPdfBtn">Solutions (pdf)</button>
    <button id="openFenBuilderBtn">Use lichess.org FEN Builder</button>

    <select id="themeSelect">
      <option value="light">Light background</option>
      <option value="dark">Dark background</option>
    </select>
  </div>

  <div id="topBar">
    <button id="modeBtn">Mode: Random</button>
    <button id="jumpBtn">Go to number #</button>
    <select id="rangeSelect">
      <option value="">Choose Range</option>
      <option value="1-300">1–300</option>
      <option value="301-600">301–600</option>
      <option value="601-900">601–900</option>
      <option value="901-1125">901–1125</option>
    </select>
  </div>
  
  <div id="card">
    <div id="meta"></div>
    <img id="boardImg" src="" alt="Position" />

    <div id="controls">

      <div id="top-buttons">
        <button id="previous-btn">← Previous</button>
        <button id="next-btn">Next →</button>
        <button id="favorite-btn">★ Favorite</button>
        <span id="favoriteIndicator">☆</span>
      </div>

      <div id="bottom-file">
        <input type="file" id="upload" multiple accept="image/*">
        <div>(Upload only images and screenshots)</div>
      </div>

    </div>

    <div id="solution" style="display:none;"></div>
    <div id="stats"></div>
  </div>


  <!-- PDF MODAL -->
  <div id="pdfModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:9999; padding:40px;">
    <div style="background:white; width:90%; height:90%; margin:0 auto; position:relative; padding:10px; border-radius:6px;">
      <button id="closePdfBtn" style="position:absolute; top:6px; right:6px; font-size:16px;">X</button>

      <iframe src="data/Sharpen_Your_Tactics_Solutions.pdf"
              style="width:100%; height:100%; border:none;"></iframe>

    </div>
  </div>

  <script>

    let mode = "random";
    function safePath(path) {
      return encodeURI(path);
    }

    const TOTAL = 1125;
    const cards = [];

    for (let i = 1; i <= TOTAL; i++) {
      cards.push({
        id: i,
        image: `problems/problem_${i}.png`,
        ease: 2.5,
        interval: 1,
        due: Date.now(),
        correct: 0,
        wrong: 0,
        favorite: false
      });
    }

    const msgDiv = document.getElementById("statusMsg");
      msgDiv.textContent = "Default images successfully loaded.";


    const progressKey = "sharpen_flashcards_progress_v3";

    function loadProgress() {
      try { return JSON.parse(localStorage.getItem(progressKey)) || {}; }
      catch { return {}; }
    }

    function saveProgress(data) {
      localStorage.setItem(progressKey, JSON.stringify(data));
    }

    let progress = loadProgress();

    function restoreProgressToCards() {
      for (const card of cards) {
        const p = progress[card.id];
        if (p) {
          card.ease = p.ease ?? card.ease;
          card.interval = p.interval ?? card.interval;
          card.due = p.due ?? card.due;
          card.correct = p.correct ?? 0;
          card.wrong = p.wrong ?? 0;
          card.favorite = p.favorite ?? false;
        }
      }
    }
    restoreProgressToCards();

    function syncCardToProgress(card) {
      progress[card.id] = {
        ease: card.ease,
        interval: card.interval,
        due: card.due,
        correct: card.correct,
        wrong: card.wrong,
        favorite: card.favorite
      };
      saveProgress(progress);
    }

function getNextDueCardIndex() {
  if (mode === "sequential") {
    return (currentIndex + 1) % cards.length;
  }

  const now = Date.now();
  const dueCards = cards
    .map((c, i) => ({c, i}))
    .filter(o => o.c.due <= now);

  if (dueCards.length > 0) {
    const pick = dueCards[Math.floor(Math.random() * dueCards.length)];
    return pick.i;
  } else {
    return Math.floor(Math.random() * cards.length);
  }
}

    let currentIndex = getNextDueCardIndex();

    function showCard(index) {
      const card = cards[index];
      const img = document.getElementById("boardImg");
      img.src = safePath(card.image);

      document.getElementById("meta").textContent = "";
      document.getElementById("solution").style.display = "none";
      document.getElementById("solution").textContent = "";
      
      const favInd = document.getElementById("favoriteIndicator");
      favInd.classList.toggle("active", card.favorite);
      favInd.textContent = card.favorite ? "★" : "☆";
    }
document.getElementById("modeBtn").addEventListener("click", () => {
  mode = (mode === "random") ? "sequential" : "random";
  document.getElementById("modeBtn").textContent =
    (mode === "random") ? "Mode: Random" : "Mode: Sequential";
});

    document.getElementById("next-btn").addEventListener("click", () => {
      currentIndex = getNextDueCardIndex();
      showCard(currentIndex);
    });

    document.getElementById("previous-btn").addEventListener("click", () => {
      currentIndex = getNextDueCardIndex();
      showCard(currentIndex);
    });

    document.getElementById("favorite-btn").addEventListener("click", () => {
      const card = cards[currentIndex];
      card.favorite = !card.favorite;
      syncCardToProgress(card);
      showCard(currentIndex);
    });

    window.addEventListener("load", () => {
      currentIndex = getNextDueCardIndex();
      showCard(currentIndex);
    });

document.getElementById("jumpBtn").addEventListener("click", () => {
  const n = parseInt(prompt("Enter card number (1-" + cards.length + "):"));
  if (!n || n < 1 || n > cards.length) return;
  currentIndex = n - 1;
  showCard(currentIndex);
});

document.getElementById('openPdfBtn').addEventListener('click', () => {
  document.getElementById('pdfModal').style.display = 'block';
});

document.getElementById('closePdfBtn').addEventListener('click', () => {
  document.getElementById('pdfModal').style.display = 'none';
});
    
document.getElementById("rangeSelect").addEventListener("change", e => {
  const [a, b] = e.target.value.split("-").map(Number);
  const r = a + Math.floor(Math.random() * (b - a + 1));
  currentIndex = r - 1;
  showCard(currentIndex);
});

const customKey = "sharpen_custom_images";
let customImages = JSON.parse(localStorage.getItem(customKey)) || [];

function saveCustomImages() {
  localStorage.setItem(customKey, JSON.stringify(customImages));
}

document.getElementById("upload").addEventListener("change", async (e) => {
  const files = Array.from(e.target.files);

  for (const file of files) {
    const url = URL.createObjectURL(file);

    const newCard = {
      id: "u_" + Date.now() + "_" + Math.random().toString(36).slice(2),
      image: url,
      ease: 2.5,
      interval: 1,
      due: Date.now(),
      correct: 0,
      wrong: 0,
      favorite: false
    };

    cards.push(newCard);
    customImages.push({ url });
  }

  saveCustomImages();

  currentIndex = cards.length - 1;
  showCard(currentIndex);
});


const fenBtn=document.getElementById('openFenBuilderBtn');
if(fenBtn){ fenBtn.addEventListener('click', ()=> window.open('https://lichess.org/editor','_blank')); }

    const themeSelect = document.getElementById("themeSelect");

themeSelect.addEventListener("change", () => {
  if (themeSelect.value === "dark") {
    document.body.classList.add("dark-mode");
  } else {
    document.body.classList.remove("dark-mode");
  }
});
  
  </script>
  
</body>
</html>




















